#!/usr/bin/env node

'use strict';

const path = require('path');
const fs = require('fs');
const config = require('../src/config');
const scriptRunner = require('../src/scriptRunner');

function existsSync(path) {
  try {
    return !!fs.statSync(path);
  } catch (e) {
    return false;
  }
}

const scriptsDir = config.scriptsDir;

if (!existsSync(scriptsDir)) {
  fs.mkdirSync(scriptsDir);
}

const scriptToRun = process.argv[2];

if (!scriptToRun) {
  console.error('Script to run not provided');
  process.exit(1);
}

let pathToScript = path.join(scriptsDir, scriptToRun);

if (!existsSync(pathToScript)) {
  if (existsSync(`${pathToScript}.js`)) {
    pathToScript += '.js';
  } else {
    console.error('Script provided does not exist');
    process.exit(1);
  }
}

const fileType = path.extname(pathToScript);

if (fileType === '.js') {
  return scriptRunner.run('node', pathToScript, process.argv.slice(3));
}

console.error(`Unable to parse script of type: ${fileType}`);
process.exit(1);
